name: Check Backend Changes

description: Check for changes in the backend-related code and return a boolean output.

outputs:
  backend:
    description: 'True if any relevant backend file changed'
    value: ${{ steps.compute.outputs.backend }}

runs:
  using: 'composite'
  steps:
    - name: Check for changes
      uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
      id: changes
      with:
        # Scripts, GitHub actions that contain 'backend' in their path.
        # The backend source code.
        # Rust files such as Cargo.lock, Cargo.toml and rust-toolchain.toml
        # The dockerfile used in this CI run, and the scripts it COPY's.
        # There may be some files in the frontend folder that contains 'backend' in their name.
        # Split into `backend_raw` and `frontend` because negations (`!…`) don’t
        # work with the default quantifier. We then combine results manually so
        # frontend files named with "backend" don’t trigger false positives.
        filters: |
          backend_raw:
            - '**/*backend*'
            - 'src/backend/**'
            - 'src/shared/**'
            - '**/Cargo*'
            - '**/*rust*'
            - 'Dockerfile'
            - 'docker/**'
          frontend:
            - 'src/frontend/**'

    - name: Compute final backend output
      id: compute
      shell: bash
      run: |
        if [[ "$BACKEND_RAW" == "true" && "$FRONTEND" != "true" ]]; then
          echo "backend=true" >> "$GITHUB_OUTPUT"
        else
          echo "backend=false" >> "$GITHUB_OUTPUT"
        fi
      env:
        BACKEND_RAW: ${{ steps.changes.outputs.backend_raw }}
        FRONTEND: ${{ steps.changes.outputs.frontend }}
