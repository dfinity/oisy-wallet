<!doctype html>
<html lang="en">
	<head>
		<!-- Init theme as fast as possible -->
		<script theme-loader>
			try {
				const isDarkPreferred = window.matchMedia('(prefers-color-scheme: dark)').matches;

				const currentTheme =
					localStorage.nnsTheme === null ||
					localStorage.nnsTheme === undefined ||
					localStorage.nnsTheme === ''
						? undefined
						: JSON.parse(localStorage.nnsTheme);

				document.documentElement.setAttribute(
					'theme',
					currentTheme ?? (isDarkPreferred ? 'dark' : 'light')
				);
			} catch (error) {
				console.error('Error initializing theme', error);
			}
		</script>

		<!-- Init language as fast as possible -->
		<script language-loader>
			try {
				const currentLanguage =
					localStorage.lang === null || localStorage.lang === undefined || localStorage.lang === ''
						? undefined
						: JSON.parse(localStorage.lang);

				document.documentElement.setAttribute('lang', currentLanguage ?? 'en');
			} catch (error) {
				console.error('Error initializing language', error);
			}
		</script>

		<style>
			:root {
				&,
				#app-background-container {
					background: #e8f1ff;
				}
				color: #000;
			}
			:root[theme='dark'] {
				&,
				#app-background-container {
					background: #070f1c;
				}
				color: #f4f6fa;
			}
		</style>

		<!-- CONTENT_SECURITY_POLICY -->

		<meta charset="utf-8" />
		<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport" />

		<title>{{OISY_NAME}}</title>
		<link href="https://oisy.com" rel="canonical" />
		<meta content="{{OISY_DESCRIPTION}}" name="description" />
		<meta content="{{OISY_NAME}}" property="og:title" />
		<meta content="{{OISY_DESCRIPTION}}" property="og:description" />
		<meta content="website" property="og:type" />
		<meta content="https://oisy.com" property="og:url" />
		<meta content="https://oisy.com/images/meta-share-v3.jpg" property="og:image" />
		<meta content="summary_large_image" name="twitter:card" />
		<meta content="{{OISY_NAME}}" name="twitter:title" />
		<meta content="{{OISY_DESCRIPTION}}" name="twitter:description" />
		<meta content="https://oisy.com/images/meta-share-v3.jpg" name="twitter:image" />
		<meta content="@dfinity" name="twitter:creator" />

		<link crossorigin="anonymous" href="/manifest.webmanifest" rel="manifest" />

		<!-- Favicon -->
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="%sveltekit.assets%/favicons/favicon-32x32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="%sveltekit.assets%/favicons/favicon-16x16.png"
		/>
		<link rel="shortcut icon" href="%sveltekit.assets%/favicon.ico" />

		<!-- iOS meta tags & icons -->
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="#016DFC" />
		<meta name="apple-mobile-web-app-title" content="{{OISY_NAME}}" />
		<link rel="apple-touch-icon" href="%sveltekit.assets%/favicons/apple-touch-icon.png" />
		<link
			rel="mask-icon"
			href="%sveltekit.assets%/favicons/safari-pinned-tab.svg"
			color="#016DFC"
		/>

		<!-- MS -->
		<meta name="msapplication-TileColor" content="#016DFC" />
		<meta name="msapplication-config" content="%sveltekit.assets%/favicons/browserconfig.xml" />

		<meta content="#FFFFFF" name="theme-color" />
		%sveltekit.head%
		<!-- ROUTE_STYLE -->

		<style>
			#app-spinner {
				--spinner-size: 30px;

				color: rgb(0, 102, 255);

				width: var(--spinner-size);
				height: var(--spinner-size);

				animation: app-spinner-linear-rotate 2000ms linear infinite;

				position: absolute;
				top: calc(50% - (var(--spinner-size) / 2));
				left: calc(50% - (var(--spinner-size) / 2));

				--radius: 45px;
				--circumference: calc(3.14159265359 * var(--radius) * 2);

				--start: calc((1 - 0.05) * var(--circumference));
				--end: calc((1 - 0.8) * var(--circumference));
			}

			#app-spinner circle {
				stroke-dasharray: var(--circumference);
				stroke-width: 10%;
				transform-origin: 50% 50% 0;

				transition-property: stroke;

				animation-name: app-spinner-stroke-rotate-100;
				animation-duration: 4000ms;
				animation-timing-function: cubic-bezier(0.35, 0, 0.25, 1);
				animation-iteration-count: infinite;

				fill: transparent;
				stroke: currentColor;

				transition: stroke-dashoffset 225ms linear;
			}

			@keyframes app-spinner-linear-rotate {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			@keyframes app-spinner-stroke-rotate-100 {
				0% {
					stroke-dashoffset: var(--start);
					transform: rotate(0);
				}
				12.5% {
					stroke-dashoffset: var(--end);
					transform: rotate(0);
				}
				12.5001% {
					stroke-dashoffset: var(--end);
					transform: rotateX(180deg) rotate(72.5deg);
				}
				25% {
					stroke-dashoffset: var(--start);
					transform: rotateX(180deg) rotate(72.5deg);
				}

				25.0001% {
					stroke-dashoffset: var(--start);
					transform: rotate(270deg);
				}
				37.5% {
					stroke-dashoffset: var(--end);
					transform: rotate(270deg);
				}
				37.5001% {
					stroke-dashoffset: var(--end);
					transform: rotateX(180deg) rotate(161.5deg);
				}
				50% {
					stroke-dashoffset: var(--start);
					transform: rotateX(180deg) rotate(161.5deg);
				}

				50.0001% {
					stroke-dashoffset: var(--start);
					transform: rotate(180deg);
				}
				62.5% {
					stroke-dashoffset: var(--end);
					transform: rotate(180deg);
				}
				62.5001% {
					stroke-dashoffset: var(--end);
					transform: rotateX(180deg) rotate(251.5deg);
				}
				75% {
					stroke-dashoffset: var(--start);
					transform: rotateX(180deg) rotate(251.5deg);
				}

				75.0001% {
					stroke-dashoffset: var(--start);
					transform: rotate(90deg);
				}
				87.5% {
					stroke-dashoffset: var(--end);
					transform: rotate(90deg);
				}
				87.5001% {
					stroke-dashoffset: var(--end);
					transform: rotateX(180deg) rotate(341.5deg);
				}
				100% {
					stroke-dashoffset: var(--start);
					transform: rotateX(180deg) rotate(341.5deg);
				}
			}

			#app-background-container {
				contain: paint;
				pointer-events: none;

				position: fixed;
				top: 0;
				left: 50%;

				transform: translateX(-50%);

				width: 100%;
				height: 100%;

				z-index: -1;

				overflow: hidden;
			}

			#app-background-light,
			#app-background-dark {
				contain: paint;
				pointer-events: none;

				width: 100%;
				min-width: 1728px;
			}

      :root[theme='light'] {
          #app-background-light {
              display: block;
          }

          #app-background-dark {
              display: none;
          }
      }

      :root[theme='dark'] {
          #app-background-light {
              display: none;
          }

          #app-background-dark {
              display: block;
          }
      }
		</style>

		<!-- LINKS_PRELOADER -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div id="app-background-container">
			<img id="app-background-light" src="/images/oisy_bg_light.webp" alt="OISY Background light theme" />
			<img id="app-background-dark" src="/images/oisy_bg_dark.webp" alt="OISY Background dark theme" />
		</div>

		<div style="display: contents">%sveltekit.body%</div>

		<!-- All resources required to boot the dapp can take some times to be downloaded on the IC. -->
		<!-- That's why we are displaying a spinner while the dapp is starting. -->
		<!-- Spinner which is then removed as soon as the authentication is initialized (regardless if sign-in or sign-out) -->
		<svg
			id="app-spinner"
			preserveAspectRatio="xMidYMid meet"
			focusable="false"
			aria-hidden="true"
			data-tid="spinner"
			viewBox="0 0 100 100"
		>
			<circle cx="50%" cy="50%" r="45" />
		</svg>

		<!-- SCRIPT_LOADER -->
	</body>
</html>
